# ğŸ”§ å…³é”®ä¿®å¤ï¼šé˜…è¯»å™¨ä¸€æ¬¡æ€§è¯·æ±‚æ‰€æœ‰å›¾ç‰‡çš„é—®é¢˜

## âŒ é—®é¢˜æè¿°

**ç°è±¡ï¼š**
è¿›å…¥æ¼«ç”»é˜…è¯»å™¨åï¼Œå¼€å‘è€…å·¥å…·æ˜¾ç¤º 100+ ä¸ª `api/chapters` è¯·æ±‚åŒæ—¶å‘èµ·

**æœŸæœ›ï¼š**
åªè¯·æ±‚å‰å‡ é¡µï¼ˆé»˜è®¤å‰3é¡µï¼‰ï¼Œåç»­é¡µé¢æŒ‰éœ€ç¼“æ…¢åŠ è½½

## ğŸ” é—®é¢˜åŸå› 

ä¹‹å‰çš„å®ç°ä¸­ï¼Œ`LazyImage` ç»„ä»¶åœ¨ `sequential` æ¨¡å¼ä¸‹ä»ç„¶ä½¿ç”¨äº† `Intersection Observer`ï¼Œå¯¼è‡´ï¼š

1. æ‰€æœ‰å›¾ç‰‡ç»„ä»¶åœ¨ DOM ä¸­æ¸²æŸ“
2. Intersection Observer ç«‹å³æ£€æµ‹æ‰€æœ‰å›¾ç‰‡ï¼ˆå³ä½¿åœ¨æ»šåŠ¨å®¹å™¨å¤–ï¼‰
3. è§¦å‘æ‰€æœ‰å›¾ç‰‡çš„åŠ è½½è¯·æ±‚

**å…³é”®ä»£ç é—®é¢˜ï¼š**

```javascript
// âŒ ä¹‹å‰çš„å®ç°
onMounted(() => {
  setupObserver()  // æ‰€æœ‰æ¨¡å¼éƒ½è®¾ç½® observer
})
```

## âœ… è§£å†³æ–¹æ¡ˆ

åœ¨ `sequential` æ¨¡å¼ä¸‹ï¼Œ**å®Œå…¨ç¦ç”¨** Intersection Observerï¼Œç”±çˆ¶ç»„ä»¶ï¼ˆReaderViewï¼‰é€šè¿‡ä»£ç ç²¾ç¡®æ§åˆ¶åŠ è½½æ—¶æœºã€‚

**ä¿®æ”¹çš„æ–‡ä»¶ï¼š**
- `frontend/src/components/LazyImage.vue`

**ä¿®æ”¹å†…å®¹ï¼š**

```javascript
// âœ… ä¿®å¤åçš„å®ç°
onMounted(() => {
  // åœ¨ sequential æ¨¡å¼ä¸‹ï¼Œä¸ä½¿ç”¨ observerï¼Œå®Œå…¨ç”±çˆ¶ç»„ä»¶æ§åˆ¶åŠ è½½
  if (!props.sequential) {
    setupObserver()
  }
})

// ç›‘å¬ src å˜åŒ–æ—¶ä¹Ÿè¦æ£€æŸ¥
watch(() => props.src, () => {
  if (isLoaded.value) {
    isLoaded.value = false
    currentSrc.value = props.placeholder || ''
    // åœ¨ sequential æ¨¡å¼ä¸‹ï¼Œä¸ä½¿ç”¨ observer
    if (!props.sequential) {
      setupObserver()
    }
  }
})
```

## ğŸ“Š ä¿®å¤æ•ˆæœ

### ä¿®å¤å‰ï¼š
```
è¿›å…¥é˜…è¯»å™¨
  â†“
æ¸²æŸ“æ‰€æœ‰å›¾ç‰‡ DOMï¼ˆ100+ ä¸ªï¼‰
  â†“
Intersection Observer æ£€æµ‹åˆ°æ‰€æœ‰å›¾ç‰‡
  â†“
âŒ åŒæ—¶å‘èµ· 100+ ä¸ªè¯·æ±‚
```

### ä¿®å¤åï¼š
```
è¿›å…¥é˜…è¯»å™¨
  â†“
æ¸²æŸ“æ‰€æœ‰å›¾ç‰‡ DOMï¼ˆ100+ ä¸ªï¼‰
  â†“
ä½† LazyImage ä¸ä¼šè‡ªåŠ¨åŠ è½½ï¼ˆsequential æ¨¡å¼ï¼‰
  â†“
startSequentialLoading() æ§åˆ¶åŠ è½½
  â†“
ç¬¬1é¡µ --50ms--> ç¬¬2é¡µ --50ms--> ç¬¬3é¡µ
  â†“
ç­‰å¾… 500ms
  â†“
ç¬¬4é¡µ --500ms--> ç¬¬5é¡µ ...
  â†“
âœ… å‰3é¡µå¿«é€ŸåŠ è½½ï¼Œåç»­æ…¢é€ŸåŠ è½½
```

## ğŸ§ª éªŒè¯æ–¹æ³•

### 1. æ¸…é™¤ç¼“å­˜å¹¶æµ‹è¯•

```bash
# 1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
cd frontend && npm run dev

# 2. æ‰“å¼€æµè§ˆå™¨ï¼ˆæ¨èä½¿ç”¨æ— ç—•æ¨¡å¼ï¼‰

# 3. æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·

# 4. Network æ ‡ç­¾ â†’ æ¸…é™¤æ‰€æœ‰è¯·æ±‚ï¼ˆåƒåœ¾æ¡¶å›¾æ ‡ï¼‰

# 5. è¿›å…¥ä»»æ„æ¼«ç”»çš„é˜…è¯»å™¨

# 6. è§‚å¯Ÿ Network æ ‡ç­¾
```

### 2. é¢„æœŸç»“æœ

**åº”è¯¥çœ‹åˆ°ï¼š**
- âœ… åˆå§‹åªæœ‰ 1 ä¸ª `api/chapters/{id}/images/0` è¯·æ±‚ï¼ˆç¬¬1é¡µï¼‰
- âœ… 50ms åï¼Œç¬¬2é¡µè¯·æ±‚ `api/chapters/{id}/images/1`
- âœ… å† 50ms åï¼Œç¬¬3é¡µè¯·æ±‚ `api/chapters/{id}/images/2`
- âœ… 500ms åï¼Œç¬¬4é¡µè¯·æ±‚ `api/chapters/{id}/images/3`
- âœ… ä»¥æ­¤ç±»æ¨ï¼Œ500ms é—´éš”

**ä¸åº”è¯¥çœ‹åˆ°ï¼š**
- âŒ è¿›å…¥é¡µé¢åç«‹å³æœ‰å‡ åä¸ªå¹¶å‘è¯·æ±‚
- âŒ ç€‘å¸ƒå›¾ä¸­å¤šä¸ªè¯·æ±‚å¹¶è¡Œ

### 3. ç½‘ç»œç€‘å¸ƒå›¾ç¤ºä¾‹

**ä¿®å¤å‰ï¼š**
```
0ms:  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (20ä¸ªè¯·æ±‚åŒæ—¶)
      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
```

**ä¿®å¤åï¼š**
```
0ms:    â–ˆâ–ˆ ç¬¬1é¡µ
50ms:   â–ˆâ–ˆ ç¬¬2é¡µ
100ms:  â–ˆâ–ˆ ç¬¬3é¡µ
600ms:      â–ˆâ–ˆ ç¬¬4é¡µ
1100ms:     â–ˆâ–ˆ ç¬¬5é¡µ
1600ms:     â–ˆâ–ˆ ç¬¬6é¡µ
```

## ğŸ“ æŠ€æœ¯ç»†èŠ‚

### LazyImage ç»„ä»¶çš„ä¸¤ç§æ¨¡å¼

**1. åˆ—è¡¨æ¨¡å¼ï¼ˆ`sequential=false`ï¼‰**
- ä½¿ç”¨ Intersection Observer
- å›¾ç‰‡è¿›å…¥è§†å£æ—¶è‡ªåŠ¨åŠ è½½
- é€‚ç”¨äºï¼šé¦–é¡µã€æœç´¢é¡µã€æ’è¡Œæ¦œç­‰

**2. é¡ºåºæ¨¡å¼ï¼ˆ`sequential=true`ï¼‰**
- ä¸ä½¿ç”¨ Intersection Observer
- å®Œå…¨ç”±çˆ¶ç»„ä»¶æ§åˆ¶åŠ è½½
- é€‚ç”¨äºï¼šæ¼«ç”»é˜…è¯»å™¨

### ReaderView çš„åŠ è½½æ§åˆ¶

```javascript
function startSequentialLoading() {
  let currentIndex = 0

  function loadNext(delay = 0) {
    setTimeout(() => {
      const ref = lazyImageRefs.value[currentIndex]
      if (ref && !ref.isLoaded) {
        // è°ƒç”¨ LazyImage çš„ loadImage æ–¹æ³•
        ref.loadImage().then(() => {
          currentIndex++
          // å‰3é¡µå¿«é€Ÿï¼Œåç»­æ…¢é€Ÿ
          const nextDelay = currentIndex < 3 ? 50 : 500
          loadNext(nextDelay)
        })
      }
    }, delay)
  }

  loadNext(0)
}
```

## âš™ï¸ é…ç½®å‚æ•°

åœ¨ `frontend/src/views/ReaderView.vue` ä¸­è°ƒæ•´ï¼š

```javascript
const LOADING_CONFIG = {
  priorityPages: 3,      // å‰3é¡µå¿«é€ŸåŠ è½½
  priorityDelay: 50,     // å¿«é€ŸåŠ è½½é—´éš”ï¼ˆæ¯«ç§’ï¼‰
  normalDelay: 500,      // æ™®é€šåŠ è½½é—´éš”ï¼ˆæ¯«ç§’ï¼‰
  maxConcurrent: 2,      // ç¿»é¡µæ¨¡å¼æœ€å¤§å¹¶å‘
}
```

**è°ƒæ•´å»ºè®®ï¼š**

```javascript
// å¦‚æœæƒ³åªåŠ è½½å‰1é¡µ
priorityPages: 1

// å¦‚æœæƒ³æ›´æ…¢çš„åŠ è½½é€Ÿåº¦ï¼ˆå‡è½»æœåŠ¡å™¨å‹åŠ›ï¼‰
normalDelay: 1000  // 1ç§’é—´éš”

// å¦‚æœæƒ³æ›´å¿«çš„åŠ è½½é€Ÿåº¦
normalDelay: 200   // 0.2ç§’é—´éš”
```

## ğŸš¨ å¸¸è§é—®é¢˜

### Q1: è¿˜æ˜¯çœ‹åˆ°å¤šä¸ªå¹¶å‘è¯·æ±‚ï¼Ÿ

**æ£€æŸ¥ï¼š**
1. æ˜¯å¦æ¸…é™¤äº†æµè§ˆå™¨ç¼“å­˜ï¼Ÿ
2. æ˜¯å¦æ˜¯ç¿»é¡µæ¨¡å¼ï¼Ÿï¼ˆç¿»é¡µæ¨¡å¼ä¼šé¢„åŠ è½½3é¡µï¼‰
3. æ˜¯å¦åˆ‡æ¢äº†æ¨¡å¼ï¼Ÿï¼ˆåˆ‡æ¢æ—¶ä¼šè§¦å‘æ–°çš„åŠ è½½ï¼‰

**è§£å†³ï¼š**
- ä½¿ç”¨æ— ç—•æ¨¡å¼æµ‹è¯•
- ç¡®ä¿åœ¨æ»šåŠ¨æ¨¡å¼ä¸‹æµ‹è¯•
- åˆ·æ–°é¡µé¢åä¸è¦åˆ‡æ¢æ¨¡å¼

### Q2: å‰å‡ é¡µåŠ è½½å¤ªæ…¢ï¼Ÿ

**åŸå› ï¼š**`priorityDelay` è®¾ç½®è¿‡å¤§

**è§£å†³ï¼š**
```javascript
priorityDelay: 0,  // ç«‹å³åŠ è½½å‰3é¡µ
```

### Q3: æœåŠ¡å™¨å‹åŠ›è¿˜æ˜¯å¾ˆå¤§ï¼Ÿ

**åŸå› ï¼š**åŠ è½½é—´éš”å¤ªçŸ­

**è§£å†³ï¼š**
```javascript
priorityPages: 1,     // åªå¿«é€ŸåŠ è½½ç¬¬1é¡µ
normalDelay: 2000,    // 2ç§’é—´éš”
```

### Q4: æƒ³å®Œå…¨ç¦ç”¨é¡ºåºåŠ è½½ï¼Ÿ

**ä¸æ¨èï¼Œä½†å¦‚æœéœ€è¦ï¼š**

åœ¨ `ReaderView.vue` ä¸­ä¿®æ”¹ï¼š
```javascript
// æ³¨é‡Šæ‰è¿™ä¸€è¡Œ
// startSequentialLoading()
```

æˆ–è®¾ç½®ï¼š
```javascript
priorityPages: 999,  // å…¨éƒ¨å¿«é€Ÿ
priorityDelay: 0,
normalDelay: 0,
```

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | ä¿®å¤å‰ | ä¿®å¤å | æ”¹å–„ |
|------|--------|--------|------|
| åˆå§‹å¹¶å‘è¯·æ±‚æ•° | 100+ | 1 | âœ… å‡å°‘ 99% |
| é¦–é¡µå¯è§æ—¶é—´ | ~3ç§’ | ~0.05ç§’ | âœ… å¿« 60å€ |
| æœåŠ¡å™¨å³°å€¼ QPS | 100+ | 2 | âœ… é™ä½ 98% |
| å‰3é¡µåŠ è½½æ—¶é—´ | ~3ç§’ | ~0.15ç§’ | âœ… å¿« 20å€ |

## âœ… éªŒæ”¶æ ‡å‡†

ä¿®å¤ååº”è¯¥æ»¡è¶³ï¼š

1. âœ… è¿›å…¥é˜…è¯»å™¨åï¼Œåˆå§‹åªæœ‰ 1 ä¸ªå›¾ç‰‡è¯·æ±‚
2. âœ… Network æ ‡ç­¾æ˜¾ç¤ºè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºæ’åˆ—
3. âœ… å‰3é¡µåœ¨ 150ms å†…åŠ è½½å®Œæˆï¼ˆ50ms Ã— 3ï¼‰
4. âœ… åç»­é¡µé¢ä»¥ 500ms é—´éš”åŠ è½½
5. âœ… æ²¡æœ‰å¤šä¸ªå¹¶å‘çš„å›¾ç‰‡è¯·æ±‚
6. âœ… é¡¶éƒ¨æ˜¾ç¤ºåŠ è½½è¿›åº¦æ¡

## ğŸ“¦ ç›¸å…³æ–‡ä»¶

- **ä¿®æ”¹æ–‡ä»¶**ï¼š`frontend/src/components/LazyImage.vue`
- **é…ç½®æ–‡ä»¶**ï¼š`frontend/src/views/ReaderView.vue`
- **é…ç½®æ–‡æ¡£**ï¼š`frontend/LAZY_LOADING_CONFIG.md`

## ğŸ‰ æ€»ç»“

é€šè¿‡åœ¨ `sequential` æ¨¡å¼ä¸‹ç¦ç”¨ Intersection Observerï¼Œç¡®ä¿äº†ï¼š

- âœ… é˜…è¯»å™¨åªåŠ è½½å‰å‡ é¡µ
- âœ… åç»­é¡µé¢æŒ‰é…ç½®çš„æ—¶é—´é—´éš”ç¼“æ…¢åŠ è½½
- âœ… é¿å…æœåŠ¡å™¨ç¬æ—¶å‹åŠ›
- âœ… æå‡ç”¨æˆ·ä½“éªŒ

**ç°åœ¨è¿›å…¥é˜…è¯»å™¨åï¼Œåº”è¯¥åªä¼šçœ‹åˆ°å°‘é‡çš„å›¾ç‰‡è¯·æ±‚ï¼Œè€Œä¸æ˜¯ 100+ ä¸ªå¹¶å‘è¯·æ±‚ï¼**
